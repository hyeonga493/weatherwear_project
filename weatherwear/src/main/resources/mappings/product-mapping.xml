<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ProductDAO">

	<insert id="insertProduct">
		INSERT INTO product(proId, proCate, proName, proContent, proSell)  VALUES(#{proId}, #{proCate}, #{proName}, #{proContent}, #{proSell});
	</insert>
	
	<insert id="insertProductPrice">
		INSERT INTO product_price(proId, proPrimeCost) VALUES(#{proId}, #{proPrimeCost});
	</insert>
	
	<insert id="insertOption">
		INSERT INTO option_sample(proId, opColor, opSize, stCnt) VALUES (#{ proId }, #{ opColor }, #{ opSize }, #{ stCnt })
	</insert>

	<update id="updateProduct">
		UPDATE product
		SET proSell = #{proSell}, proName = #{proName}, proContent = #{proContent}, proCate = #{proCate}
		WHERE proId = #{proId}
	</update>

	<update id="updateProductPrice">
		UPDATE product_price
		SET proId = #{proId}, proPrimeCost = #{proPrimeCost}
		WHERE proId = #{proId}
	</update>
	
	<insert id="deleteOption">
		DELETE FROM option_sample
		WHERE proId = #{proId}
	</insert>
	
    <!-- ON DELETE CASCADE : FK 포함된 table에서 데이터 모두 삭제 -->
	<delete id="deleteProduct">
		DELETE FROM product WHERE proId = #{proId}  
	</delete>
	
	<select id="getProduct" resultType="product">
		SELECT * FROM product
		JOIN product_price ON product.proId = product_price.proId
		WHERE product.proId = #{proId}
	</select>    
	
	<select id="getColorList" resultType="String">
		SELECT  opColor FROM option_sample
		WHERE proId = #{proId}
		GROUP BY opColor
	</select>
	
	<select id="getSizeList" resultType="String">
		SELECT  opSize FROM option_sample
		WHERE proId = #{proId}
		GROUP BY opSize
	</select>
	
	<select id="getCntList" resultType="int">
		SELECT  stCnt FROM option_sample
		WHERE proId = #{proId} 
	</select>
	
	<select id="getProductList" resultType="product">
		SELECT * FROM product
		JOIN product_price ON product.proId = product_price.proId
		WHERE proName LIKE '%'||#{searchKeyword}||'%' 
		ORDER BY product.proRegDate DESC;
	</select>
	
</mapper>